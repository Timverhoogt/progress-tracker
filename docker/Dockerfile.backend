FROM node:20-alpine

WORKDIR /app

# Install Python and build dependencies needed for native modules
RUN apk add --no-cache python3 make g++

# Copy package files
COPY backend/package*.json ./
RUN npm install

# Copy source code
COPY backend/src ./src
COPY backend/tsconfig.json ./

# Build TypeScript
RUN npm run build

# Expose port
EXPOSE 3060

# Health check defined in docker-compose.yml

CMD ["npm", "start"]
